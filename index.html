<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>å®¢æˆ¶ç­”éŒ„æ©Ÿ</title>
    <script>
      // You can also require other files to run in this process
      const aa = require('./renderer.js')
      const {clipboard} = require('electron');
      const util = require('util')
    </script>
    <script>
      window.$ = window.jQuery = require('./bower_components/jquery/dist/jquery.min.js');</script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/material-icons.css">
    <link rel="stylesheet" href="css/index.css">
  </head>
  <body>
    <!-- ç¬¬ä¸€éšæ®µï¼šè¼¸å…¥ -->
    <section class="step-1">
      <header class="app-header">
        <h1 class="app-header__title">å®Œç¾å›è¦†</h1>
        <p class="app-header__desc">Hiï¼Œå°å®¢æˆ¶çš„å•é¡Œæ„Ÿåˆ°<strong>åƒé©šã€ç–‘æƒ‘ã€ä¸è§£å—ï¼Ÿ</strong><br>è©¦è©¦çœ‹å®Œç¾å›è¦†å§ ğŸ˜€</p>
      </header>
      <main class="input-area">
        <p class="inut-area__tip">è«‹è¤‡è£½å¥½å®¢æˆ¶å•é¡Œçš„æ–‡å­—ã€‚</p>
        <input id="getReplyBtn" class="btn btn-default  btn-action input-area__button" type="button" value="è¤‡è£½å¥½äº†ï¼Œå¹«åŠ©æˆ‘å›è¦†ï¼">
      </main>
      <div class="stuff--top-left"></div>
      <div class="stuff--top-right"></div>
      <div class="stuff--bottom-left"></div>
      <div class="stuff--bottom-right"></div>
    </section>


    <!-- ç¬¬äºŒéšæ®µï¼šè§£æ -->
    <section class="step-2">
      <main class="input">
        <h2 class="input__title">ä¾†è‡ªæ‚¨çš„å®¢æˆ¶ï¼š</h2>
        <p class="input__content">
          Hi Koch,<br>
          é€™ä¸æ˜¯å¾ˆç°¡å–®å—ï¼Œç‚ºä»€éº¼è¦åšé€™éº¼ä¹…ï¼Ÿ<br>
          Regards,<br>
          Mike
        </p>
      </main>
      <img class="processing-bar" src="" width="90" height="90" />
    </section>


    <!-- ç¬¬ä¸‰éšæ®µï¼šè¼¸å‡º -->
    <section class="step-3">
      <main class="output">
        <h2 class="output__title">å°ˆå±¬æ‚¨çš„å®Œç¾å›è¦†ï¼š</h2>
        <div class="output__content">
          <h3>å°Šæ•¬çš„å®¢æˆ¶æ‚¨å¥½ï¼š</h3>
          <h3 class="output__answer">è«‹å•ä½ æ˜¯åœ¨å¤§è²ä»€éº¼å•¦</h3>
          <h3>Best Regards,</h3>
          <h3>è¦ªåˆ‡çš„å·¥ç¨‹å¸«</h3>
        </div>
      </main>
      <div class="output-copy">
        <p class="output-copy__wow">Yes!</p>
        <p class="output-copy__msg">å®Œç¾å›è¦†å·²ç¶“æˆåŠŸè¤‡è£½åˆ°å‰ªè²¼ç°¿å›‰ âœ…</p>
      </div>
      <div class="output-actions">
        <button class="btn  btn-action btn-back"><!-- <i class="material-icons">keyboard_arrow_left</i> --><span>æˆ‘æœ‰æ–°çš„å®¢æˆ¶å•é¡Œ</span></button>
        <button class="btn  btn-action btn-copy"><i class="material-icons">content_copy</i></button>
        <button id="fbShareBtn" class="btn  btn-action btn-share"><i class="material-icons">share</i></button>
      </div>
    </section>


    <!-- Modal -->
    <div class="modal fade" id="validateModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
            <h4 class="modal-title" id="myModalLabel">Modal title</h4>
          </div>
          <div class="modal-body" style="color:#747474">
            ...
          </div>
        </div>
      </div>
    </div>


    <!-- All of the Node.js APIs are available in this renderer process. -->
    <!-- We are using node <script>document.write(process.versions.node)</script>,
    Chromium <script>document.write(process.versions.chrome)</script>,
    and Electron <script>document.write(process.versions.electron)</script>. -->


    <!-- å–å¾—ç­”æ¡ˆä¹‹æ¸¬è©¦æŒ‰éˆ• -->
    <!-- <button onclick="aa.alertAnswer()">å–å¾—ç­”æ¡ˆ</button> -->

    <script>
      var ValidateService = require('./validateService.js')
      var ModalService = require('./modalService.js')
      var RenderContentService = require('./renderContentService.js')
      var validateService = new ValidateService({lengthLimit: 250})
      var modalService = new ModalService('#validateModal')
      var inputContentService = new RenderContentService('.input__content')
      var outputContentService = new RenderContentService('.output__content')

      $('#getReplyBtn').on('click', onGetReply);
      $('#fbShareBtn').on('click',onShareFb);

      function onShareFb(){
        aa.fbShare().then(function(data){
          modalService.show({title:'',body:'è«‹åˆ° "https://www.facebook.com/device" è¼¸å…¥ä»¥ä¸‹é©—è­‰ç¢¼'+data.user_code+'ä»¥åˆ†äº«æœ¬Appè‡³æ‚¨çš„facebook'});
        },function(err){
          alert("hi");
        })
      }

      function onGetReply (e) {
        validateService.validate()
        .then(stepOne, onValidateError)
        .then(stepTwo)
      }

      function onValidateError(error) {
        if (error.type == 'string_empty') {
          modalService.show({title: '', body:'æ²’æœ‰è¤‡è£½å…§å®¹'})
        }

        if (error.type == 'string_too_long') {
          modalService.show({title: '', body:'è¶…å‡ºå­—æ•¸'})
        }
      }

      function stepOne(data) {
        stuffFlyAway();
        stepOneSlideUp();
        stepTwoSlideUp();
        stepThreeSplit();
        inputContentService.render(data.text);
        return aa.fetchAnswer(data.text);
      }

      function stepTwo(answer) {
        clipboard.writeText(util.format(
        `å°Šæ•¬çš„å®¢æˆ¶æ‚¨å¥½ï¼š

           %s

        Best Regards,

        è¦ªåˆ‡çš„å·¥ç¨‹å¸«`,answer))
        outputContentService.render(answer)
      }

      function stuffFlyAway() {
        $('.stuff--top-left').addClass('is-fly-away');
        $('.stuff--top-right').addClass('is-fly-away');
        $('.stuff--bottom-left').addClass('is-fly-away');
        $('.stuff--bottom-right').addClass('is-fly-away');
      }

      function stepOneSlideUp() {
        $('.app-header').addClass('is-silde-up');
        $('.input-area').addClass('is-silde-up');
        $('.step-1').addClass('is-slide-up');
      }

      function stepTwoSlideUp() {
        $('.input').addClass('is-slide-up');
        window.setTimeout(function(){
          $('.processing-bar')
            .show()
            .attr('src', 'img/step-2/Step2_TimeCounter_whiteNoBG.gif');
        }, 1800);
      }

      function stepThreeSplit() {
        window.setTimeout(function(){
          $('.input').fadeOut('400');
          $('.processing-bar').fadeOut('slow');
          $('.step-2').addClass('is-slide-up');
        }, 9000);
      }

    </script>
  </body>
</html>
